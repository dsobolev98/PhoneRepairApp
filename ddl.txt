CREATE DATABASE CSC226PROJECT;

CREATE TABLE PROFILE(
	ID INT NOT NULL,
	USERNAME VARCHAR(20) NOT NULL,
	PASSWORD VARCHAR(100) NOT NULL,
	TYPE CHAR(1) NOT NULL,
	PRIMARY KEY(ID),
	UNIQUE(USERNAME)
);

CREATE TABLE CUSTOMER_PROFILE(
	FIRSTNAME VARCHAR(40) NOT NULL,
	LASTNAME VARCHAR(40) NOT NULL,
	EMAIL VARCHAR(100) NOT NULL,
	PHONE_NUM VARCHAR(10) NOT NULL,
	ADDRESS VARCHAR(100) NOT NULL,
	CITY VARCHAR(45) NOT NULL,
	STATE VARCHAR(2) NOT NULL,
	ZIP VARCHAR(5) NOT NULL,
	CUSTOMER_ID INT NOT NULL,
	CONSTRAINT pk_Customer PRIMARY KEY (FIRSTNAME, LASTNAME, EMAIL),
	FOREIGN KEY (CUSTOMER_ID) REFERENCES PROFILE(ID)
);

CREATE TABLE EMPLOYEE_PROFILE(
	FIRSTNAME VARCHAR(40) NOT NULL,
	LASTNAME VARCHAR(40) NOT NULL,
	EMAIL VARCHAR(100) NOT NULL,
	PHONE_NUM VARCHAR(10) NOT NULL,
	PROFILE_ID INT NOT NULL,
	CONSTRAINT pk_Employee PRIMARY KEY (FIRSTNAME, LASTNAME, EMAIL),
	FOREIGN KEY (PROFILE_ID) REFERENCES PROFILE(ID)
);

CREATE TABLE INQUIRY(
	REPAIR_ID INT NOT NULL,
	CUS_ID INT NOT NULL,
	MAKE VARCHAR(45) NOT NULL,
	MODEL VARCHAR(45) NOT NULL,
	SERIAL_NUM VARCHAR(100) NOT NULL,
	PROBLEM TEXT NOT NULL,
	IMAGE VARCHAR(100),
	DATE_POSTED DATETIME NOT NULL,
	PRIMARY KEY(REPAIR_ID),
	FOREIGN KEY (CUS_ID) REFERENCES PROFILE(ID)
);

CREATE TABLE STATUS_ESTIMATE(
	STATUS_ID INT NOT NULL,
	REPAIR_ID INT NOT NULL,
	REPAIRABLE TINYINT(1) NOT NULL,
	ESTIMATE VARCHAR(100),
	DATE_POSTED DATE,
	PRIMARY KEY(STATUS_ID),
	FOREIGN KEY (REPAIR_ID) REFERENCES INQUIRY(REPAIR_ID)
);

CREATE TABLE STATUS_INVOICE(
	STATUS_ID INT NOT NULL,
	REPAIR_ID INT NOT NULL,
	INVOICE VARCHAR(100),
	DATE_POSTED DATE,
	PRIMARY KEY(STATUS_ID),
	FOREIGN KEY (REPAIR_ID) REFERENCES INQUIRY(REPAIR_ID)
);

CREATE TABLE STATUS_SHIPPING(
	STATUS_ID INT NOT NULL,
	REPAIR_ID INT NOT NULL,
	TRACKING_NUM VARCHAR(22),
	DATE_POSTED DATE,
	PRIMARY KEY(STATUS_ID),
	FOREIGN KEY (REPAIR_ID) REFERENCES INQUIRY(REPAIR_ID)
);

CREATE TABLE CHECKOUT(
	TRANS_ID INT NOT NULL,
	CUS_ID INT NOT NULL,
	REPAIR_ID INT NOT NULL,
	AMOUNT_DUE DOUBLE(10,2) NOT NULL,
	AMOUNT_PAID DOUBLE(10,2) NOT NULL,
	DATE_POSTED DATETIME,
	PRIMARY KEY(TRANS_ID),
	FOREIGN KEY (CUS_ID) REFERENCES PROFILE(ID),
	FOREIGN KEY (REPAIR_ID) REFERENCES INQUIRY(REPAIR_ID)
);

CREATE TABLE CHECKOUT_BILLING_INFO(
	TRANS_ID INT NOT NULL,
	FIRST_NAME VARCHAR(40) NOT NULL,
	LAST_NAME VARCHAR(40) NOT NULL,
	ADDRESS VARCHAR(100) NOT NULL,
	CITY VARCHAR(40) NOT NULL,
	STATE VARCHAR(40) NOT NULL,
	ZIP VARCHAR(5) NOT NULL,
	CARD_NUM VARCHAR(16) NOT NULL,
	EXP_DATE VARCHAR(5) NOT NULL,
	CCV VARCHAR(3) NOT NULL,
	FOREIGN KEY (TRANS_ID) REFERENCES CHECKOUT(TRANS_ID),
	UNIQUE(TRANS_ID)
);

CREATE TABLE CHECKOUT_SHIPPING_INFO(
	TRANS_ID INT NOT NULL,
	FIRST_NAME VARCHAR(40) NOT NULL,
	LAST_NAME VARCHAR(40) NOT NULL,
	ADDRESS VARCHAR(100) NOT NULL,
	CITY VARCHAR(40) NOT NULL,
	STATE VARCHAR(40) NOT NULL,
	ZIP VARCHAR(5) NOT NULL,
	FOREIGN KEY (TRANS_ID) REFERENCES CHECKOUT(TRANS_ID),
	UNIQUE(TRANS_ID)
);

/* Password for admin is 'password'*/
INSERT INTO `profile` (`ID`, `USERNAME`, `PASSWORD`, `TYPE`) VALUES ('1', 'ADMIN', '$2y$10$Ugy3aaFGpe03dDeI5dJmmO/fS65cWm3DFuD9d7OZGsEMAGy0FV6Jy', 'e');
INSERT INTO EMPLOYEE_PROFILE (FIRSTNAME, LASTNAME, EMAIL, PHONE_NUM, PROFILE_ID) VALUES ('ADMIN', 'ADMIN', 'ADMIN@IREAIR.COM', '3475559020', '1');